{{define "content"}}
<div class="request-container">
    <h1 class="request-title">Корзина:</h1>

    {{if .Request}}
    <div class="address-section">
        <h2>Адрес дома, квартиры:</h2>
        <p class="address-value">{{.Request.Address}}</p>
    </div>

    <div class="devices-section">
        <h2>Устройства в заявке:</h2>
        {{range .Items}}
        <div class="request-item">
            <div class="item-image-frame">
                <img src="{{.Service.ImageURL}}" alt="{{.Service.Name}}" class="item-image">
            </div>
            <div class="item-info">
                <h3>{{.Service.Name}}</h3>
                <p>{{.Service.Model}}</p>
                <p>Трафик: {{.Service.DataPerHour}} Кб/ч</p>
            </div>
            <div class="item-quantity">
                <div class="quantity-control">
                    <button class="qty-btn minus">-</button>
                    <span class="qty-value">{{.Quantity}}</span>
                    <button class="qty-btn plus">+</button>
                </div>
                <span>Количество: {{.Quantity}}</span>
                
                <!-- УПРОСТИЛ расчет трафика -->
                <div class="traffic-calculation">
                    <div class="traffic-line">
                        <span>Трафик устройства:</span>
                        <span class="traffic-number">{{.Service.DataPerHour}} Kб/ч</span>
                    </div>
                    <div class="traffic-line">
                        <span>× количество:</span>
                        <span class="traffic-number">{{.Quantity}}</span>
                    </div>
                    <div class="traffic-line total">
                        <span>Итого:</span>
                        <!-- УБРАЛ функцию multiply, просто показываем расчет -->
                        <span class="traffic-number">{{.Service.DataPerHour}} × {{.Quantity}} Kб/ч</span>
                    </div>
                </div>
            </div>
        </div>
        {{end}}
    </div>

    <div class="calculation-section">
        <form action="/request/delete" method="POST" style="display: inline;">
            <input type="hidden" name="request_id" value="{{.Request.ID}}">
            <button type="submit" class="btn-calculate" style="background: #ff4444;">Удалить заявку</button>
        </form>
        <div class="traffic-result">
            <span>Общий объем трафика:</span>
            <span class="traffic-value">{{.Request.TotalTraffic}} Kб/ч</span>
        </div>
    </div>
    {{else}}
    <div class="empty-cart">
        <h2>Корзина пуста</h2>
        <p>Добавьте устройства из каталога</p>
        <a href="/devices" class="btn-secondary">Перейти к каталогу</a>
    </div>
    {{end}}
</div>

<script>
function changeQuantity(serviceId, delta) {
    alert('Изменение количества: услуга ' + serviceId + ', изменение: ' + delta);
}
</script>
{{end}}
